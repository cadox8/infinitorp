"use strict";(()=>{var de=Object.create;var v=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var be=(r,e,t)=>e in r?v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var y=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var a=(r,e)=>()=>(r&&(e=r(r=0)),e);var De=(r,e)=>{for(var t in e)v(r,t,{get:e[t],enumerable:!0})},ve=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ge(e))!ye.call(r,s)&&s!==t&&v(r,s,{get:()=>e[s],enumerable:!(n=H(e,s))||n.enumerable});return r};var xe=(r,e,t)=>(t=r!=null?de(he(r)):{},ve(e||!r||!r.__esModule?v(t,"default",{value:r,enumerable:!0}):t,r));var i=(r,e,t,n)=>{for(var s=n>1?void 0:n?H(e,t):e,g=r.length-1,D;g>=0;g--)(D=r[g])&&(s=(n?D(e,t,s):D(s))||s);return n&&s&&v(e,t,s),s};var o=(r,e,t)=>(be(r,typeof e!="symbol"?e+"":e,t),t);var u,p,z=a(()=>{"use strict";u=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\typeorm");R();p=class{constructor(){o(this,"id");o(this,"profile");o(this,"charges");o(this,"notes");o(this,"sentence")}};i([(0,u.PrimaryGeneratedColumn)()],p.prototype,"id",2),i([(0,u.ManyToOne)(()=>m,r=>r.id)],p.prototype,"profile",2),i([(0,u.Column)("longtext")],p.prototype,"charges",2),i([(0,u.Column)("longtext")],p.prototype,"notes",2),i([(0,u.Column)("int")],p.prototype,"sentence",2),p=i([(0,u.Entity)("mdt_suspects")],p)});var f,m,R=a(()=>{"use strict";f=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\typeorm");z();m=class{constructor(){o(this,"id");o(this,"citizenid");o(this,"notes");o(this,"mugshot_url");o(this,"reports")}};i([(0,f.PrimaryGeneratedColumn)()],m.prototype,"id",2),i([(0,f.Column)({type:"int",nullable:!1})],m.prototype,"citizenid",2),i([(0,f.Column)({type:"text",nullable:!1})],m.prototype,"notes",2),i([(0,f.Column)({type:"text",nullable:!1})],m.prototype,"mugshot_url",2),i([(0,f.OneToMany)(()=>p,r=>r.id)],m.prototype,"reports",2),m=i([(0,f.Entity)("mdt_profiles")],m)});var h,d,A=a(()=>{"use strict";h=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\typeorm");$();d=class{constructor(){o(this,"id");o(this,"url");o(this,"report")}};i([(0,h.PrimaryGeneratedColumn)()],d.prototype,"id",2),i([(0,h.Column)("text")],d.prototype,"url",2),i([(0,h.ManyToOne)(()=>l,r=>r.id)],d.prototype,"report",2),d=i([(0,h.Entity)("mdt_photos")],d)});var c,l,$=a(()=>{"use strict";c=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\typeorm");R();A();z();l=class{constructor(){o(this,"id");o(this,"title");o(this,"type");o(this,"report");o(this,"aOfficer");o(this,"officers");o(this,"suspects");o(this,"photos");o(this,"timestamp")}};i([(0,c.PrimaryGeneratedColumn)()],l.prototype,"id",2),i([(0,c.Column)({type:"varchar",length:255})],l.prototype,"title",2),i([(0,c.Column)({type:"varchar",length:255})],l.prototype,"type",2),i([(0,c.Column)("longtext")],l.prototype,"report",2),i([(0,c.ManyToOne)(()=>m,r=>r.id)],l.prototype,"aOfficer",2),i([(0,c.OneToMany)(()=>m,r=>r.id)],l.prototype,"officers",2),i([(0,c.OneToMany)(()=>p,r=>r.id)],l.prototype,"suspects",2),i([(0,c.OneToMany)(()=>d,r=>r.id)],l.prototype,"photos",2),i([(0,c.Column)("text")],l.prototype,"timestamp",2),l=i([(0,c.Entity)("mdt_reports")],l)});var j={};De(j,{Photo:()=>d,Profile:()=>m,Report:()=>l,Suspect:()=>p});var T=a(()=>{"use strict";$();R();A();z()});async function k(){return new W.Pool({type:"mysql",host:"localhost",port:3306,username:"root",password:"",database:"fivem",entities:j,synchronize:!0,logging:!1}).initialize()}var W,X=a(()=>{"use strict";W=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\typeorm");T()});var b,_e,Ce,E,Y=a(()=>{"use strict";b=xe(y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\winston")),_e=r=>`\x1B[36m${r}\x1B[0m]`,Ce=r=>r.module?`${r.label} @ ${_e(r.module)}: ${r.message}`:`${r.label}: ${r.message}`,E=b.default.createLogger({level:"debug",transports:[new b.default.transports.Console({format:b.default.format.combine(b.default.format.label({label:"[\x1B[33mMDT\x1B[0m"}),b.default.format.colorize({all:!0}),b.default.format.printf(Ce))})]})});var x,Z=a(()=>{"use strict";T();x=class{constructor(e,t,n){o(this,"name","Profiles");o(this,"DB");o(this,"logger");o(this,"qbcore");this.DB=e,this.logger=t.child({module:"Profiles"}),this.qbcore=n,this.logger.info("Loaded Module")}async getProfiles(e,t=0,n=20){try{return[{}]}catch(s){return this.logger.error(s),!1}}async getProfile(e){return{}}async createProfile(e){try{let t=new m;return t.citizenid=e.citizenid,t.notes=e.notes,t.mugshot_url=e.mugshot_url,t.reports=e.reports,await this.DB.manager.save(t)}catch(t){return this.logger.error(t),!1}}}});var _,K=a(()=>{"use strict";_=class{constructor(e,t,n){o(this,"name","DMV");o(this,"DB");o(this,"logger");o(this,"qbcore");this.DB=e,this.logger=t.child({module:"DMV"}),this.qbcore=n,this.logger.info("Loaded Module")}}});var C,N=a(()=>{"use strict";C=class{constructor(e,t,n){o(this,"name","Noticeboard");o(this,"DB");o(this,"logger");o(this,"qbcore");this.DB=e,this.logger=t.child({module:"Noticeboard"}),this.qbcore=n,this.logger.info("Loaded Module")}}});var P,ee=a(()=>{"use strict";T();P=class{constructor(e,t,n){o(this,"name","Reports");o(this,"DB");o(this,"logger");o(this,"qbcore");this.DB=e,this.logger=t.child({module:"Reports"}),this.qbcore=n,this.logger.info("Loaded Module")}async getReports(e,t,n){try{return[{}]}catch(s){return this.logger.error(s),!1}}async getReport(e){return{}}async createReport(e){try{let t=new l;return t.title=e.title,t.type=e.type,t.report=e.report,t.aOfficer=e.aOfficer,t.officers=e.officers,t.suspects=e.suspects,t.photos=e.photos,t.timestamp=e.timestamp,await this.DB.manager.save(t)}catch(t){return this.logger.error(t),!1}}}});var S,re=a(()=>{"use strict";S=class{constructor(e,t,n){o(this,"name","Dispatch");o(this,"DB");o(this,"logger");o(this,"qbcore");this.DB=e,this.logger=t.child({module:"Dispatch"}),this.qbcore=n,this.logger.info("Loaded Module")}}});function I(r,e,t){return e&&t&&(r?onNet:on)(e,t),(n,s,g)=>{(r?onNet:on)(e!=null?e:s,g.value.bind(n))}}var te=a(()=>{"use strict"});function w(){try{return L||(L=JSON.parse(LoadResourceFile(GetCurrentResourceName(),"config.json")),L)}catch(r){console.log("Failed to load config.json")}return{}}var L,G=a(()=>{"use strict";L=null});var M,oe=a(()=>{"use strict";te();G();M=class{constructor(e,t,n){o(this,"name","Auth");o(this,"DB");o(this,"logger");o(this,"qbcore");o(this,"config");o(this,"authorizedClients");this.config=w(),this.DB=e,this.logger=t.child({module:"Auth"}),this.qbcore=n,this.authorizedClients=[],I(!1,"QBCore:Server:PlayerLoaded",this.loadClient.bind(this)),I(!1,"QBCore:Server:OnPlayerUnload",this.playerDropped.bind(this)),I(!0,"playerDropped",this.playerDropped.bind(this));for(let[s,g]of Object.entries(this.qbcore.Players))this.loadClient(g);this.logger.info("Loaded Module")}async isAuthorized(e){return this.authorizedClients.some(t=>t.src===e)}loadClient(e){this.config.auth.allowed_job_types.includes(e.PlayerData.job.name.toLowerCase())?(this.authorizedClients.push({src:e.PlayerData.source,cid:e.PlayerData.cid,callsign:e.PlayerData.metadata.callsign,state:e.PlayerData.job.onduty}),this.logger.child({module:"Auth"}).info(`Loaded client ${e.PlayerData.source} as ${e.PlayerData.metadata.callsign}`)):this.logger.child({module:"Auth"}).info(`Client ${e.PlayerData.source} is not authorized`)}unloadClient(e){this.logger.child({module:"Auth"}).info("Unloading client "+e),this.authorizedClients=this.authorizedClients.filter(t=>t.src!==parseInt(e))}playerDropped(e){this.unloadClient(String(global.source))}}});var ie,ne=a(()=>{"use strict";Z();K();N();ee();re();oe();ie=[M,x,_,C,P,S]});var U,q,se=a(()=>{"use strict";U=class{static init(){for(let[e,t]of Object.entries(U.api_handlers))onNet(e,async(n,...s)=>{t(n,...s)})}},q=U;o(q,"api_handlers",{});q.init()});function F(r){return function(e,t,n){let s=n.value;onNet(r!=null?r:t,async(...g)=>{let D=global.source;await B.getModule("Auth").isAuthorized(D)?n.value(D,...g):console.log("Unauthorized attempt to call",t)})}}var ae=a(()=>{"use strict";Q()});var le,O,me=a(()=>{le=(s=>(s.req_open="mdt_request_open",s.mdt_s_c="mdt_s_c",s.mdt_show="mdt_ui_show",s.mdt_close="mdt_ui_close",s))(le||{}),O=le});var V,ce=a(()=>{"use strict";ae();me();V=class{static request_open(r){console.log(`Player ${r} requested to open the MDT`),emitNet(O.mdt_s_c,r,O.mdt_show,!0)}};i([F(O.req_open)],V,"request_open",1)});var pe,ue=a(()=>{pe=["Traffic Report","Crime Report","Administrative Report"]});var Pe={};var fe=a(()=>{"use strict";se();ce();Q();ue();(async()=>{let r=await B.getModule("Profiles").createProfile({citizenid:123,notes:"test",mugshot_url:"https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png",reports:[1]});console.log(r);let e=await B.getModule("Reports").createReport({title:"A very cool report title",type:pe[0],report:"This is a very cool report",aOfficer:r,officers:[],suspects:[],photos:[],timestamp:new Date});console.log(e)})()});var Or,Se,J,B,Q=a(()=>{Or=y("D:\\FiveMDev\\txData\\resources\\[inf]\\left-mdt\\node_modules\\reflect-metadata");X();Y();ne();G();Se=w();console.log(Se);J=class{constructor(){o(this,"DB");o(this,"modules");o(this,"qbcore");k().then(async e=>{this.DB=e,this.qbcore=global.exports["qb-core"].GetCoreObject(),E.child({module:"Database"}).info("Connected to database"),this.modules=ie.map(t=>new t(this.DB,E,this.qbcore)),await Promise.resolve().then(()=>(fe(),Pe))})}getModule(e){return this.modules.find(t=>t.name===e)}},B=new J});Q();})();
